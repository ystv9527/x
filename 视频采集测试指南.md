# 🎬 视频采集测试指南

## ✅ 已修复的问题

**问题：** 浏览器扩展没有下载视频

**原因：** 
- ❌ `add-auto.html` 从 URL 参数读取数据时，缺少 `videos` 参数处理
- ❌ 服务器响应中没有显示视频下载统计

**修复：**
- ✅ 添加了 URL 参数中 `videos` 的读取
- ✅ 服务器响应中添加了 `downloadedVideos` 统计
- ✅ 服务器日志显示图片和视频数量

---

## 🧪 测试步骤

### 1. 重启服务器

**重要：** 必须重启服务器使修改生效！

1. 关闭当前运行的服务器（关闭命令行窗口）
2. 双击 `启动服务器.bat` 重新启动

### 2. 重新加载浏览器扩展

1. 打开浏览器扩展管理页面
   - Chrome: `chrome://extensions/`
   - Edge: `edge://extensions/`

2. 找到"X 推文收藏助手"

3. 点击刷新按钮 🔄（重新加载扩展）

### 3. 测试采集带视频的推文

1. 打开 X(Twitter)

2. 找一条**带视频**的推文

3. 点击推文下方的 **📚 采集** 按钮

4. 查看自动打开的采集页面：
   - ✅ 应该显示 "正在下载 N 张图片..."
   - ✅ 应该显示 "正在下载 N 个视频..."
   - ✅ 进度条显示下载进度

5. 填写表单并保存

### 4. 查看服务器日志

服务器命令行窗口应该显示：

```
📥 下载视频 1: https://video.twimg.com/...
✅ 视频保存成功: tweet-xxx-1.mp4
✅ Content saved: [推文标题]
📊 统计: 图片 0 个, 视频 1 个
```

### 5. 检查文件

1. 打开 `E:\gitpromts\videos\` 目录

2. 应该看到下载的视频文件：
   ```
   tweet-xxx-1.mp4
   ```

3. 双击视频，确认可以播放

### 6. 生成数据集

运行：
```bash
node scripts\generate-dataset.js
```

或双击 `Generate-Data.bat`

### 7. 查看网页展示

1. 打开 http://localhost:3000

2. 刷新页面

3. 点击有视频的文章卡片

4. 在详情页面应该看到：
   - ✅ 视频播放器
   - ✅ 可以直接播放视频

---

## 🎯 预期结果

### 采集页面显示
```
✅ 已下载 0 张图片, 1 个视频
将在保存时自动上传到服务器
```

### 服务器日志显示
```
📥 下载视频 1: https://video.twimg.com/...
🔌 使用代理: http://127.0.0.1:7897
✅ 视频保存成功: tweet-123456-1.mp4
✅ Content saved: [标题]
📊 统计: 图片 0 个, 视频 1 个
```

### collection.md 包含
```markdown
## [标题]
...

### 相关视频
<video width="100%" controls><source src="../videos/tweet-xxx-1.mp4" type="video/mp4"></video>
```

### 网页展示
- 详情页面有视频播放器
- 可以直接播放视频

---

## ❌ 如果还是不工作

### 检查清单

1. **服务器是否重启？**
   - 必须重启才能加载新代码

2. **浏览器扩展是否重新加载？**
   - 在扩展管理页面点击刷新

3. **推文是否真的有视频？**
   - 有些是GIF，不是视频
   - 确保是 `<video>` 标签

4. **代理是否正常？**
   - 确认 Clash 或代理在运行
   - 端口是 7897

5. **浏览器控制台有错误吗？**
   - 按 F12 打开开发者工具
   - 查看 Console 标签

6. **服务器日志有错误吗？**
   - 查看命令行窗口的输出

---

## 🔍 调试技巧

### 浏览器控制台（F12）

采集时应该看到：
```javascript
📝 采集推文: [标题]
📸 处理的图片URLs: [...]
🎬 处理的视频URLs: ["https://video.twimg.com/..."]
```

### 服务器日志

应该看到：
```
📥 下载视频 1: https://video.twimg.com/...
✅ 视频保存成功: tweet-xxx-1.mp4
```

### 检查视频URL

在浏览器控制台输入：
```javascript
document.querySelectorAll('video')
```

应该能看到视频元素

---

## 📞 仍然有问题？

1. 截图浏览器控制台的输出
2. 截图服务器日志
3. 确认推文链接

---

✅ 修复完成 | 📅 2025-01-05
