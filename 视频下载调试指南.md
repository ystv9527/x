# 🔍 视频下载调试指南

## 🎯 测试步骤

### 第一步：测试基本下载功能

**运行测试脚本：**
```bash
双击：测试视频下载.bat
```
或
```bash
node 测试视频下载.js
```

**预期结果：**
- ✅ 应该下载一个测试视频到 `videos/` 目录
- ✅ 显示下载进度
- ✅ 显示成功消息

**如果失败：**
- 检查代理是否运行（Clash端口7897）
- 检查网络连接
- 查看错误消息

---

### 第二步：测试X视频URL

**1. 获取X视频的真实URL：**

在X上打开一条带视频的推文，然后：

1. 按 `F12` 打开开发者工具
2. 切换到 `Console` 标签
3. 在控制台输入以下代码并回车：

```javascript
// 获取视频URL
const video = document.querySelector('video');
if (video) {
  const source = video.querySelector('source');
  if (source) {
    console.log('视频URL:', source.src);
    copy(source.src); // 自动复制到剪贴板
  } else {
    console.log('未找到source标签');
  }
} else {
  console.log('未找到video标签');
}
```

4. 复制输出的URL（已自动复制到剪贴板）

**2. 测试下载这个URL：**

```bash
node 测试X视频下载.js "粘贴你复制的URL"
```

例如：
```bash
node 测试X视频下载.js "https://video.twimg.com/ext_tw_video/1234567890/pu/vid/avc1/1280x720/abc123.mp4?tag=12"
```

**预期结果：**
- ✅ 显示HTTP状态码：200
- ✅ 显示下载进度
- ✅ 保存为 `videos/x-video-test.mp4`

---

## 🐛 常见问题

### Q1: 测试视频可以下载，但X视频不行

**可能原因：**
1. **视频URL过期** - X的视频URL有时效性
2. **需要认证** - 需要登录cookies
3. **防盗链** - 需要正确的Referer头

**解决方法：**
- 使用浏览器扩展采集（自动带上cookies）
- 检查视频URL是否完整

### Q2: 403 Forbidden

**原因：** X的防盗链保护

**解决：**
- 确保使用代理
- 检查是否登录X账号
- 视频URL可能已过期（重新获取）

### Q3: 404 Not Found

**原因：** 视频不存在或URL错误

**解决：**
- 检查URL是否完整
- 确认视频是否还存在

### Q4: 网络超时

**原因：** 代理或网络问题

**解决：**
- 确认Clash正在运行
- 检查代理端口（7897）
- 尝试直连（关闭代理）

---

## 🔍 调试技巧

### 1. 查看浏览器控制台

在采集页面按F12，查看：
- Network标签：看视频下载请求
- Console标签：看JavaScript日志

### 2. 检查扩展提取的数据

在X页面按F12，Console输入：
```javascript
// 查看页面上的所有video标签
document.querySelectorAll('video')

// 查看source标签
document.querySelectorAll('video source')
```

### 3. 手动模拟扩展行为

在X页面按F12，Console输入：
```javascript
// 模拟扩展的提取逻辑
const videos = document.querySelectorAll('video');
const videoUrls = [];
videos.forEach(video => {
  const sources = video.querySelectorAll('source');
  sources.forEach(source => {
    if (source.src && source.src.includes('video.twimg.com')) {
      videoUrls.push(source.src);
    }
  });
});
console.log('提取到的视频URLs:', videoUrls);
```

---

## 📊 测试结果分析

### 情况A：测试视频✅ X视频❌

**问题：** 视频URL提取或认证问题

**检查：**
1. 浏览器扩展是否正确提取URL
2. 视频URL是否包含必要的参数
3. 是否需要cookies

### 情况B：两者都失败❌

**问题：** 网络或代理配置问题

**检查：**
1. 代理是否运行
2. 端口是否正确（7897）
3. 防火墙设置

### 情况C：两者都成功✅ 但采集时失败

**问题：** 采集流程中的bug

**检查：**
1. 服务器日志
2. 浏览器控制台
3. add-auto.html的处理逻辑

---

## 🎬 获取视频URL的完整步骤

### 方法1：使用开发者工具（推荐）

1. 在X上打开带视频的推文
2. 按F12
3. Console输入：
```javascript
document.querySelector('video source').src
```
4. 复制输出的URL

### 方法2：Network标签

1. 按F12打开开发者工具
2. 切换到Network标签
3. 刷新页面
4. 在过滤框输入：`.mp4`
5. 找到视频文件的请求
6. 右键 → Copy → Copy URL

### 方法3：查看元素

1. 右键点击视频
2. 选择"检查"
3. 在Elements标签找到`<source>`标签
4. 复制`src`属性的值

---

## 📞 下一步

运行测试后，请告诉我：
1. 哪个测试成功了？
2. 哪个测试失败了？
3. 具体的错误消息是什么？

这样我可以精确定位问题所在！

---

✅ 创建日期: 2025-01-05
